<div
    id="auto_multi_image_container"
    class="extension_container auto-multi-image-settings"
>
    <div class="inline-drawer auto-multi-drawer">
        <div
            class="inline-drawer-toggle inline-drawer-header auto-multi-drawer__toggle"
        >
            <div
                class="flex-container alignitemscenter flexGap10 auto-multi-drawer__header"
            >
                <i class="fa-solid fa-images"></i>
                <div class="auto-multi-drawer__header-text">
                    <h4 class="margin0">Image Generation Autopilot</h4>
                </div>
            </div>
            <div
                class="inline-drawer-icon fa-solid fa-circle-chevron-down down auto-multi-drawer__icon"
            ></div>
        </div>
        <div class="inline-drawer-content auto-multi-ui">
            <section class="auto-multi-hero">
                <div class="auto-multi-hero__badge">
                    <i class="fa-solid fa-sparkles"></i>
                    <span>Image Generation Autopilot</span>
                </div>
                <h4>Auto-generate multi-model images per reply.</h4>
                <p>
                    For every new message, automatically generate multiple
                    images across your selected SD models so you can compare
                    looks without manual swiping.
                </p>
                <div class="auto-multi-hero__chips">
                    <span
                        ><i class="fa-solid fa-layer-group"></i> Multi-model
                        queue</span
                    >
                    <span
                        ><i class="fa-solid fa-bars-progress"></i> Global
                        progress HUD</span
                    >
                    <span
                        ><i class="fa-solid fa-wand-magic-sparkles"></i> Auto
                        image gen</span
                    >
                    <span
                        ><i class="fa-solid fa-gear"></i> SD prompt injection</span
                    >
                </div>
            </section>

            <section class="auto-multi-panel" id="auto_multi_master_panel">
                <header>
                    <div>
                        <p class="eyebrow">
                            <i class="fa-solid fa-power-off"></i> Automation
                            control
                        </p>
                        <h5>Toggle the autopilot</h5>
                    </div>
                    <p class="caption">
                        Enable swipe automation and automatic image creation.
                    </p>
                </header>
                <label class="checkbox_label auto-multi-toggle" title="Toggle automatic image generation from assistant replies.">
                    <input type="checkbox" id="auto_multi_auto_gen_enabled" />
                    <span>Enable auto image generation</span>
                </label>
                <label class="checkbox_label auto-multi-toggle" title="Toggle automatic swipe requests for each new SD image message.">
                    <input type="checkbox" id="auto_multi_image_enabled" />
                    <span>Enable auto-swipes</span>
                </label>
            </section>

            <section class="auto-multi-panel" id="auto_multi_summary_panel">
                <header>
                    <div>
                        <p class="eyebrow">
                            <i class="fa-solid fa-chart-line"></i> Live summary
                        </p>
                        <h5>At-a-glance plan</h5>
                    </div>
                </header>
                <p id="auto_multi_image_summary" class="auto-multi-summary"></p>
            </section>

            <section class="auto-multi-panel" id="auto_multi_autogen_panel">
                <header>
                    <div>
                        <p class="eyebrow">
                            <i class="fa-solid fa-image"></i> Auto generation
                        </p>
                        <h5>Generate images automatically</h5>
                    </div>
                    <p class="caption">
                        Generate images from the assistant‚Äôs replies using your
                        SD prompt guidance and insert mode.
                    </p>
                </header>
                <div class="auto-multi-grid">
                    <label title="Where generated images should be inserted.">
                        <span>Insert mode</span>
                        <select
                            id="auto_multi_auto_gen_insert_type"
                            class="text_pole"
                        >
                            <option value="disabled">Disabled</option>
                            <option value="inline">Insert in current message</option>
                            <option value="replace">Inline replace marker</option>
                            <option value="new">Create new message</option>
                        </select>
                    </label>
                    <label title="Where to inject the prompt guidance into the chat completion prompt.">
                        <span>Prompt injection position</span>
                        <select id="auto_multi_prompt_position" class="text_pole">
                            <option value="deep_system">@D ‚öôÔ∏è System</option>
                            <option value="deep_user">@D üë§ User</option>
                            <option value="deep_assistant">@D ü§ñ Assistant</option>
                        </select>
                    </label>
                    <label title="How far from the end to inject prompt guidance (0 = end of prompt).">
                        <span>Prompt injection depth</span>
                        <input
                            type="number"
                            min="0"
                            max="100"
                            step="1"
                            id="auto_multi_prompt_depth"
                            class="text_pole"
                        />
                    </label>
                </div>
                <div class="auto-multi-count-group" title="How many <pic> prompts the assistant should output per reply.">
                    <label>
                        <span>Image count rule</span>
                        <select id="auto_multi_pic_count_mode" class="text_pole">
                            <option value="exact">Exactly</option>
                            <option value="range">Between (range)</option>
                            <option value="min">At least</option>
                            <option value="max">At most</option>
                        </select>
                    </label>
                    <label
                        class="auto-multi-count-field"
                        data-count-mode="exact"
                        title="Exact number of <pic> prompts to request when using the Exact rule."
                    >
                        <span>Exact</span>
                        <input
                            type="number"
                            min="1"
                            max="12"
                            step="1"
                            id="auto_multi_pic_count_exact"
                            class="text_pole"
                        />
                    </label>
                    <label
                        class="auto-multi-count-field"
                        data-count-mode="min range"
                        title="Minimum number of <pic> prompts when using At least or Between."
                    >
                        <span>Min</span>
                        <input
                            type="number"
                            min="1"
                            max="12"
                            step="1"
                            id="auto_multi_pic_count_min"
                            class="text_pole"
                        />
                    </label>
                    <label
                        class="auto-multi-count-field"
                        data-count-mode="max range"
                        title="Maximum number of <pic> prompts when using At most or Between."
                    >
                        <span>Max</span>
                        <input
                            type="number"
                            min="1"
                            max="12"
                            step="1"
                            id="auto_multi_pic_count_max"
                            class="text_pole"
                        />
                    </label>
                </div>
                <label class="checkbox_label auto-multi-inline" title="Inject the composed guidance into the chat completion prompt.">
                    <input
                        type="checkbox"
                        id="auto_multi_prompt_injection_enabled"
                    />
                    <span>Enable prompt injection</span>
                </label>
                <div class="auto-multi-stack">
                    <label title="High-level system prompt for image generation behavior.">
                        <span>Main prompt</span>
                        <textarea
                            id="auto_multi_prompt_main"
                            class="text_pole auto-multi-textarea"
                            rows="3"
                            placeholder="Re-state hair style, outfit, and body every single time."
                        ></textarea>
                    </label>
                    <div class="auto-multi-grid">
                        <label title="Positive constraints or style rules for image prompts.">
                            <span>Image prompt instructions (positive)</span>
                            <textarea
                                id="auto_multi_prompt_positive"
                                class="text_pole auto-multi-textarea"
                                rows="2"
                                placeholder="ALWAYS mention lighting and mood.&#10;ALWAYS specify camera angle and framing."
                            ></textarea>
                        </label>
                        <label title="Negative constraints or disallowed terms for image prompts.">
                            <span>Image prompt instructions (negative)</span>
                            <textarea
                                id="auto_multi_prompt_negative"
                                class="text_pole auto-multi-textarea"
                                rows="2"
                                placeholder="NEVER include brand names.&#10;NEVER add text overlays or watermarks."
                            ></textarea>
                        </label>
                    </div>
                    <label title="Example image prompt to guide the model.">
                        <span>Example prompt</span>
                        <textarea
                            id="auto_multi_prompt_example"
                            class="text_pole auto-multi-textarea"
                            rows="2"
                            placeholder="A female with long dark hair... (example of a prompt you like)"
                        ></textarea>
                    </label>
                    <div class="auto-multi-grid">
                        <label title="Optional limit for the prompt length.">
                            <span>Image prompt length limit</span>
                            <input
                                type="number"
                                min="0"
                                step="1"
                                id="auto_multi_prompt_limit"
                                class="text_pole"
                            />
                        </label>
                        <label title="Whether the limit is counted in words or characters.">
                            <span>Length limit type</span>
                            <select
                                id="auto_multi_prompt_limit_type"
                                class="text_pole"
                            >
                                <option value="none">No limit</option>
                                <option value="words">Words</option>
                                <option value="chars">Characters</option>
                            </select>
                        </label>
                    </div>
                    <label title="Regex used to extract the prompt text (first capture group).">
                        <span>Regex (capture group 1 = prompt)</span>
                        <textarea
                            id="auto_multi_prompt_regex"
                            class="text_pole auto-multi-textarea"
                            rows="2"
                            placeholder="/<pic[^>]*\\sprompt=\"([^\"]*)\"[^>]*?>/g"
                        ></textarea>
                    </label>
                    <label
                        class="checkbox_label auto-multi-inline"
                        title="Rewrite failed <pic> prompts with the active chat model and retry image generation."
                    >
                        <input
                            type="checkbox"
                            id="auto_multi_prompt_rewrite_enabled"
                        />
                        <span>Rewrite failed prompts with chat model</span>
                    </label>
                </div>
            </section>

            <section
                class="auto-multi-panel auto-multi-panel--queue"
                id="auto_multi_queue_panel"
            >
                <header>
                    <div>
                        <p class="eyebrow">
                            <i class="fa-solid fa-cubes"></i> Model queue
                        </p>
                        <h5>Compose your lineup</h5>
                    </div>
                    <div
                        class="auto-multi-model-queue__actions flex-container flexGap5"
                    >
                        <button
                            id="auto_multi_refresh_models"
                            class="menu_button fa-solid fa-arrows-rotate"
                            title="Refresh the model list"
                        ></button>
                        <button
                            id="auto_multi_add_model"
                            class="menu_button auto-multi-add-model"
                        >
                            <span class="fa-solid fa-plus"></span>
                            <span>Add model</span>
                        </button>
                    </div>
                </header>
                <p class="caption">
                    Each row pins a model + swipe count. Leave the list empty to
                    mirror the SD panel selection.
                </p>
                <label
                    class="checkbox_label auto-multi-inline auto-multi-queue-toggle"
                    title="Enable or disable the model queue without removing entries."
                >
                    <input
                        type="checkbox"
                        id="auto_multi_model_queue_enabled"
                    />
                    <span>Enable model queue</span>
                </label>
                <div
                    id="auto_multi_model_rows"
                    class="auto-multi-model-rows"
                ></div>
            </section>

            <section class="auto-multi-panel" id="auto_multi_cadence_panel">
                <header>
                    <div>
                        <p class="eyebrow">
                            <i class="fa-solid fa-wave-square"></i> Timing &
                            strategy
                        </p>
                        <h5>Dial in swipe cadence</h5>
                    </div>
                    <p class="caption">
                        Tune swipe pacing for slow or fast backends.
                    </p>
                </header>
                <div class="auto-multi-grid">
                    <label title="Default number of swipes per model when added to the queue.">
                        <span>Default swipes per model</span>
                        <input
                            type="number"
                            min="1"
                            max="12"
                            step="1"
                            id="auto_multi_image_target"
                            class="text_pole"
                        />
                    </label>
                    <label title="Delay between swipe requests to avoid provider rate limits.">
                        <span>Delay between swipes (ms)</span>
                        <input
                            type="number"
                            min="0"
                            max="10000"
                            step="50"
                            id="auto_multi_image_delay"
                            class="text_pole"
                        />
                    </label>
                    <label title="Throttle used when burst mode is enabled (currently deprecated).">
                        <span>Burst throttle (ms)</span>
                        <input
                            type="number"
                            min="0"
                            max="5000"
                            step="25"
                            id="auto_multi_burst_throttle"
                            class="text_pole"
                        />
                    </label>
                </div>
                <label
                    class="checkbox_label auto-multi-inline"
                    title="Burst mode is deprecated and disabled."
                >
                    <input type="checkbox" id="auto_multi_burst_mode" disabled />
                    <span>Fire all swipes at once (burst mode)</span>
                </label>
                <p class="note auto-multi-burst-note margin0">
                    Burst mode is deprecated and currently disabled to prevent
                    SD requests from aborting each other.
                </p>
            </section>


            <section class="auto-multi-panel" id="auto_multi_character_panel">
                <header>
                    <div>
                        <p class="eyebrow">
                            <i class="fa-solid fa-user-tag"></i> Per-character
                            overrides
                        </p>
                        <h5>Save settings with the character</h5>
                    </div>
                    <p class="caption">
                        When enabled, all extension settings are stored in the
                        character card data (shareable).
                    </p>
                </header>
                <label
                    class="checkbox_label auto-multi-inline"
                    title="When enabled, settings are saved to the active character card."
                >
                    <input type="checkbox" id="auto_multi_character_enabled" />
                    <span>Enable per-character settings (shareable)</span>
                </label>
                <div class="auto-multi-character-actions flex-container flexGap10">
                    <button
                        type="button"
                        id="auto_multi_character_reset"
                        class="menu_button"
                        title="Clear the saved overrides for the active character."
                    >
                        Reset to global defaults
                    </button>
                    <p class="caption margin0">
                        Clears the saved snapshot from the character card so the
                        global defaults are used again.
                    </p>
                </div>
            </section>
            <section class="auto-multi-panel" id="auto_multi_debug_panel">
                <header>
                    <div>
                        <p class="eyebrow">
                            <i class="fa-solid fa-bug"></i> Debugging
                        </p>
                        <h5>Diagnostics</h5>
                    </div>
                    <p class="caption">
                        Enable verbose logging for troubleshooting.
                    </p>
                </header>
                <label class="checkbox_label auto-multi-inline" title="Enable debug logging in the browser console.">
                    <input type="checkbox" id="auto_multi_debug_mode" />
                    <span>Debug mode</span>
                </label>
            </section>

            <section class="auto-multi-panel auto-multi-panel--presets" id="auto_multi_presets_panel">
                <header>
                    <div>
                        <p class="eyebrow">
                            <i class="fa-solid fa-bookmark"></i> Preset profiles
                        </p>
                        <h5>Save and apply preset settings</h5>
                    </div>
                    <p class="caption">
                        Create and manage presets to quickly apply specific image generation configurations.
                    </p>
                </header>
                
                <div class="auto-multi-preset-actions flex-container flexGap10">
                    <button
                        type="button"
                        id="auto_multi_save_preset_button"
                        class="menu_button auto-multi-save-preset"
                        title="Save current settings as a new preset"
                    >
                        <span class="fa-solid fa-floppy-disk"></span>
                        <span>Save as preset</span>
                    </button>
                    <input
                        type="text"
                        id="auto_multi_new_preset_name"
                        class="text_pole auto-multi-new-preset-name"
                        placeholder="Enter preset name..."
                        style="width: 250px;"
                    />
                </div>

                <div class="auto-multi-preset-list" id="auto_multi_preset_list">
                    <!-- Presets will be dynamically inserted here -->
                    <p class="caption auto-multi-preset-empty" style="text-align: center; padding: 20px;">
                        No presets saved yet. Click "Save as preset" to create your first preset.
                    </p>
                </div>
            </section>
        </div>
    </div>
</div>
